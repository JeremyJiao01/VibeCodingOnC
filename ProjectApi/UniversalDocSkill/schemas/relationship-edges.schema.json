{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Relationship Edges",
  "description": "Output schema for RelationshipMapper sub-agent. Describes all inter-module relationships.",
  "type": "object",
  "required": ["projectName", "importGraphEdges", "dataFlowEdges", "communicationPatterns"],
  "properties": {
    "projectName": {
      "type": "string",
      "minLength": 1
    },
    "importGraphEdges": {
      "type": "array",
      "description": "Static import/require/include dependencies between modules",
      "items": {
        "type": "object",
        "required": ["source", "target", "type"],
        "properties": {
          "source": {
            "type": "string",
            "description": "Module ID of the importing module"
          },
          "target": {
            "type": "string",
            "description": "Module ID of the imported module, or external package name"
          },
          "type": {
            "type": "string",
            "enum": ["static_import", "dynamic_import", "re_export", "type_only", "side_effect"]
          },
          "importedSymbols": {
            "type": "array",
            "items": { "type": "string" },
            "description": "List of specific symbols imported (empty for wildcard/default)"
          },
          "isExternal": {
            "type": "boolean",
            "default": false
          }
        }
      }
    },
    "dataFlowEdges": {
      "type": "array",
      "description": "Runtime data flow between modules",
      "items": {
        "type": "object",
        "required": ["source", "target", "dataType", "mechanism"],
        "properties": {
          "source": { "type": "string" },
          "target": { "type": "string" },
          "dataType": {
            "type": "string",
            "description": "Type or shape of data flowing between modules"
          },
          "mechanism": {
            "type": "string",
            "enum": ["function_call", "event", "callback", "shared_state", "message_passing", "stream", "file_io", "database"]
          },
          "description": { "type": "string" }
        }
      }
    },
    "communicationPatterns": {
      "type": "array",
      "description": "High-level communication patterns detected",
      "items": {
        "type": "object",
        "required": ["pattern", "participants"],
        "properties": {
          "pattern": {
            "type": "string",
            "enum": ["pub_sub", "request_response", "observer", "mediator", "pipeline", "middleware_chain", "event_bus", "shared_memory"]
          },
          "participants": {
            "type": "array",
            "items": { "type": "string" },
            "minItems": 2
          },
          "description": {
            "type": "string",
            "minLength": 20
          }
        }
      }
    },
    "circularDependencies": {
      "type": "array",
      "description": "Detected circular dependency chains",
      "items": {
        "type": "object",
        "required": ["cycle", "severity"],
        "properties": {
          "cycle": {
            "type": "array",
            "items": { "type": "string" },
            "minItems": 2,
            "description": "Ordered list of module IDs forming the cycle"
          },
          "severity": {
            "type": "string",
            "enum": ["info", "warning", "error"]
          },
          "suggestion": { "type": "string" }
        }
      }
    }
  },
  "additionalProperties": false
}
